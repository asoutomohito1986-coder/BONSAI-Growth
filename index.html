<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BONSAI STYLE EVOLUTION</title>
    <style>
        body { text-align: center; background: #121212; color: #fff; font-family: sans-serif; margin: 0; }
        #style-select { height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #222; }
        #game-screen { display: none; padding: 20px; }
        .stats { display: flex; justify-content: center; gap: 10px; margin: 20px 0; }
        .card { background: #333; padding: 15px; border-radius: 12px; flex: 1; max-width: 100px; border: 1px solid #444; }
        .val { font-size: 20px; color: #4caf50; font-weight: bold; }
        #view { width: 280px; height: 280px; background: #000; margin: 20px auto; border-radius: 20px; display: flex; align-items: center; justify-content: center; overflow: hidden; border: 4px solid #333; image-rendering: pixelated; }
        #view img { width: 100%; height: 100%; object-fit: cover; }
        .btn { padding: 16px; border-radius: 50px; border: none; font-weight: bold; font-size: 16px; margin: 8px; width: 90%; max-width: 300px; cursor: pointer; }
        .btn-style { background: #fff; color: #333; }
        .btn-w { background: #4caf50; color: #fff; }
        .btn-g { background: #ff9800; color: #fff; }
        .btn:disabled { opacity: 0.2; }
    </style>
</head>
<body>

    <div id="style-select">
        <h2>ËÇ≤Êàê„Çπ„Çø„Ç§„É´„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ</h2>
        <button class="btn btn-style" onclick="startWith('chokkan')">Áõ¥Âππ (Straight)</button>
        <button class="btn btn-style" onclick="startWith('shakan')">ÊñúÂππ (Slanted)</button>
        <button class="btn btn-style" onclick="startWith('moyogi')">Ê®°ÊßòÊú® (Curved)</button>
    </div>

    <div id="game-screen">
        <div class="stats">
            <div class="card">GP<br><span id="ui-gp" class="val">0</span></div>
            <div class="card">Ê®πÈΩ¢<br><span id="ui-age" class="val">0</span></div>
            <div class="card">Âûã<br><span id="ui-style" class="val">-</span></div>
        </div>
        <div id="view">üå±</div>
        <div id="timer" style="color:#ffeb3b; height:20px; margin:10px; font-weight:bold;"></div>
        <button class="btn btn-w" onclick="doW()">üíß Ê∞¥„ÇÑ„Çä (+10GP)</button>
        <button id="gb" class="btn btn-g" onclick="doG()" disabled>‚ú® ÊàêÈï∑ (50GP)</button>
        <div id="status" style="font-size:12px; color:#888; margin-top:10px;"></div>
        <button onclick="localStorage.clear();location.reload();" style="margin-top:40px; opacity:0.2; background:none; color:#fff; border:none;">[Style Reset]</button>
    </div>

    <script>
        let gp=0, age=0, img="", last=Date.now(), style="";
        const LIMIT = 1209600000;

        window.onload = function() {
            const s = localStorage.getItem('bonsai_v13');
            if(s) {
                const d = JSON.parse(s);
                style = d.style;
                showGame();
                load(d);
            }
        };

        function startWith(s) {
            style = s;
            showGame();
            save();
            update();
        }

        function showGame() {
            document.getElementById('style-select').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
        }

        function doW() { gp+=10; last=Date.now(); save(); update(); }

        async function doG() {
            if(gp<50) return;
            gp-=50; age+=5;
            const v=document.getElementById('view'), b=document.getElementById('gb'), t=document.getElementById('timer');
            v.style.opacity="0.4"; b.disabled=true;
            
            let s=10;
            const i=setInterval(()=>{ t.innerText="Growing... "+s+"s"; s--; if(s<0)clearInterval(i); },1000);

            // „Çπ„Çø„Ç§„É´„Å´Âøú„Åò„Åü„Éó„É≠„É≥„Éó„ÉàË™øÊï¥
            let stylePrompt = "chokkan, formal upright style";
            if(style === 'shakan') stylePrompt = "shakan, slanted trunk style, leaning";
            if(style === 'moyogi') stylePrompt = "moyogi, informal upright style, curvy trunk";

            let stage = (age < 50) ? "young sprout" : (age < 150) ? "mature tree" : "ancient majestic tree";
            const prompt = encodeURIComponent(`16-bit_pixel_art, ${stylePrompt}, ${stage}, bonsai, in_pot, white_background`);
            const url = `https://image.pollinations.ai/prompt/${prompt}?seed=${Math.floor(Math.random()*9999)}&width=512&height=512&nologo=true`;

            const temp = new Image();
            temp.src = url;
            temp.onload = () => {
                clearInterval(i); t.innerText="SUCCESS!"; img=url;
                v.innerHTML=`<img src="${url}">`; v.style.opacity="1";
                save(); update();
                setTimeout(()=>t.innerText="",2000);
            };
        }

        function save() { localStorage.setItem('bonsai_v13', JSON.stringify({gp,age,img,last,style})); }
        function load(d) { gp=d.gp||0; age=d.age||0; img=d.img||""; last=d.last||Date.now(); style=d.style; }
        
        function update() {
            document.getElementById('ui-gp').innerText = gp;
            document.getElementById('ui-age').innerText = age;
            document.getElementById('ui-style').innerText = (style==='chokkan'?'Áõ¥Âππ':style==='shakan'?'ÊñúÂππ':'Ê®°ÊßòÊú®');
            document.getElementById('gb').disabled = (gp < 50);
            if(img && (Date.now()-last <= LIMIT)) document.getElementById('view').innerHTML=`<img src="${img}">`;
        }
    </script>
</body>
</html>
