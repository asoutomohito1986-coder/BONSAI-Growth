<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BONSAI SELECT EVOLUTION</title>
    <style>
        body { text-align: center; background: #121212; color: #fff; font-family: sans-serif; margin: 0; padding: 0; }
        #game-screen { padding: 10px; }
        .stats { display: flex; justify-content: center; gap: 5px; margin: 10px 0; }
        .card { background: #333; padding: 10px; border-radius: 12px; flex: 1; border: 1px solid #444; min-width: 80px; }
        .val { font-size: 18px; color: #4caf50; font-weight: bold; }
        
        #view { width: 280px; height: 280px; background: #000; margin: 15px auto; border-radius: 20px; display: flex; align-items: center; justify-content: center; overflow: hidden; border: 4px solid #333; image-rendering: pixelated; }
        #view img { width: 100%; height: 100%; object-fit: cover; }

        .btn { padding: 16px; border-radius: 50px; border: none; font-weight: bold; font-size: 18px; margin: 8px; width: 90%; max-width: 320px; cursor: pointer; }
        .btn-w { background: #4caf50; color: #fff; box-shadow: 0 4px 0 #2e7d32; }
        .btn-g { background: #ff9800; color: #fff; box-shadow: 0 4px 0 #e68a00; }
        .btn:disabled { opacity: 0.2 !important; transform: translateY(4px); box-shadow: none !important; }

        /* ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .style-dropdown { 
            background: #444; color: #fff; padding: 12px; border-radius: 10px; 
            border: 1px solid #666; font-size: 16px; width: 80%; max-width: 250px; 
            margin: 10px auto; display: block; appearance: none; text-align: center;
        }

        #timer { color:#ffeb3b; font-weight: bold; height:20px; margin:5px; }
        #status { font-size:11px; color:#666; margin-top:20px; }
    </style>
</head>
<body>

    <div id="game-screen">
        <div class="stats">
            <div class="card">GP<br><span id="ui-gp" class="val">0</span></div>
            <div class="card">æ¨¹é½¢<br><span id="ui-age" class="val">0</span></div>
        </div>

        <div id="view">ğŸŒ±</div>
        <div id="timer"></div>

        <button class="btn btn-w" onclick="doW()">ğŸ’§ æ°´ã‚„ã‚Š (+10GP)</button>
        <button id="gb" class="btn btn-g" onclick="doG()" disabled>âœ¨ æˆé•· (50GP)</button>
        
        <div style="margin-top: 20px; font-size: 13px; color: #aaa;">â–¼ æ¬¡ã®æˆé•·ã§ç›®æŒ‡ã™å‹ã‚’é¸æŠ</div>
        <select id="style-select" class="style-dropdown" onchange="setTarget(this.value)">
            <option value="chokkan">ç›´å¹¹ (Straight)</option>
            <option value="shakan">æ–œå¹¹ (Slanted)</option>
            <option value="moyogi">æ¨¡æ§˜æœ¨ (Curved)</option>
        </select>

        <div id="status"></div>
        <button onclick="if(confirm('ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')){localStorage.clear();location.reload();}" style="margin-top:40px; opacity:0.3; background:none; color:#fff; border:none; text-decoration: underline;">[Data Reset]</button>
    </div>

    <script>
        let gp = 0, age = 0, img = "", last = Date.now(), targetStyle = "chokkan";
        const LIMIT = 1209600000;

        // èµ·å‹•æ™‚ã®å‡¦ç†
        window.onload = function() {
            try {
                const s = localStorage.getItem('bonsai_v16');
                if(s) {
                    const d = JSON.parse(s);
                    gp = Number(d.gp) || 0;
                    age = Number(d.age) || 0;
                    img = d.img || "";
                    last = Number(d.last) || Date.now();
                    targetStyle = d.target || "chokkan";
                    document.getElementById('style-select').value = targetStyle;
                }
            } catch(e) { console.error("Load Error"); }
            update();
        };

        function setTarget(s) {
            targetStyle = s;
            save();
        }

        function doW() {
            gp += 10;
            last = Date.now();
            save();
            update();
        }

        async function doG() {
            if(gp < 50) return;
            gp -= 50;
            age += 5;
            
            const v = document.getElementById('view'), b = document.getElementById('gb'), t = document.getElementById('timer');
            v.style.opacity = "0.3"; b.disabled = true;
            
            let sec = 10;
            const itv = setInterval(() => {
                t.innerText = "Growing... " + sec + "s";
                sec--;
                if(sec < 0) clearInterval(itv);
            }, 1000);

            const styleMap = {chokkan: 'formal_upright', shakan: 'slanted', moyogi: 'informal_upright_curved'};
            let stage = (age < 50) ? "young_seedling" : (age < 150) ? "growing_tree" : "ancient_tree";
            
            // å¾ã€…ã«å¤‰åŒ–ã•ã›ã‚‹ãŸã‚ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
            const prompt = encodeURIComponent(`16-bit_pixel_art,bonsai_tree,transitioning_to_${styleMap[targetStyle]}_style,${stage},in_pot,white_background`);
            const url = `https://image.pollinations.ai/prompt/${prompt}?seed=${Math.floor(Math.random()*9999)}&width=512&height=512&nologo=true`;

            const temp = new Image();
            temp.src = url;
            temp.onload = () => {
                clearInterval(itv);
                t.innerText = "EVOLVED!";
                img = url;
                v.innerHTML = `<img src="${url}">`;
                v.style.opacity = "1";
                save();
                update();
                setTimeout(() => t.innerText = "", 2000);
            };
        }

        function save() { 
            localStorage.setItem('bonsai_v16', JSON.stringify({ gp, age, img, last, target: targetStyle })); 
        }
        
        function update() {
            document.getElementById('ui-gp').innerText = gp;
            document.getElementById('ui-age').innerText = age;
            document.getElementById('gb').disabled = (gp < 50);
            
            const now = Date.now();
            if(img && (now - last <= LIMIT)) {
                document.getElementById('view').innerHTML = `<img src="${img}">`;
            } else if (now - last > LIMIT) {
                document.getElementById('view').innerHTML = '<div style="font-size:80px;">ğŸ‚</div>';
            }
            
            const st = document.getElementById('status');
            if(now - last > LIMIT) {
                st.innerHTML = "<span style='color:red'>æ¯ã‚Œã¦ã„ã¾ã™</span>";
            } else {
                const dLeft = Math.ceil((LIMIT - (now - last)) / 86400000);
                st.innerText = "ç”Ÿå­˜å¯èƒ½: æ®‹ã‚Š " + dLeft + " æ—¥";
            }
        }
    </script>
</body>
</html>
