<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BONSAI GROWTH - Coinbase Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://unpkg.com/@coinbase/wallet-sdk@3.7.1/dist/index.js"></script>
    <style>
        body { text-align: center; background-color: #f4f4f2; font-family: sans-serif; margin: 0; }
        #title-screen { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; background: #0052FF; color: white; padding: 20px; box-sizing: border-box; }
        #game-screen { display: none; padding-top: 30px; }
        .btn-coinbase { padding: 18px 30px; border-radius: 15px; background: white; color: #0052FF; border: none; cursor: pointer; font-weight: bold; font-size: 20px; display: flex; align-items: center; gap: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .btn-coinbase:active { transform: scale(0.98); }
        .water-btn { font-size: 24px; padding: 15px 60px; background-color: #5d6d3e; color: white; border: none; border-radius: 12px; cursor: pointer; margin-top: 20px; }
        #wallet-address { font-size: 12px; background: #ddd; padding: 8px; border-radius: 8px; word-break: break-all; max-width: 80%; margin: 10px auto; }
    </style>
</head>
<body>

    <div id="title-screen">
        <div style="font-size: 80px; margin-bottom: 20px;">ğŸŒ²</div>
        <h1 style="letter-spacing: 3px; margin: 0;">BONSAI GROWTH</h1>
        <p style="opacity: 0.9; margin-bottom: 40px;">Base Chain Native Experience</p>
        
        <button id="connect-btn" class="btn-coinbase">
            <img src="https://www.coinbase.com/favicon.ico" width="28">
            ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
        </button>
        
        <p id="debug-info" style="font-size: 10px; margin-top: 20px; opacity: 0.7;"></p>
    </div>

    <div id="game-screen">
        <h1>BONSAI GROWTH <small>v3.0</small></h1>
        <p id="wallet-address"></p>
        <div id="bonsai-image" style="font-size: 120px; margin: 30px;">ğŸŒ²</div>
        <h2>æ¨¹é½¢: <span id="age-display">0</span> æ—¥</h2>
        <p id="status-message" style="color: blue;">å…ƒæ°—ã«è‚²ã£ã¦ã„ã¾ã™ï¼</p>
        
        <button id="water-btn" class="water-btn" onclick="waterBonsai()">ğŸ’§ æ°´ã‚„ã‚Š</button>
        
        <div style="margin-top: 50px; border-top: 1px solid #ccc; padding-top: 20px;">
            <button onclick="downloadCSV()">ğŸ“‹ è¨˜éŒ²ä¿å­˜</button>
            <button onclick="resetGame()" style="color:red; margin-left: 10px;">âš ï¸ ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
    </div>

    <script>
        // --- è¨­å®š ---
        const APP_NAME = "BONSAI GROWTH";
        const APP_LOGO_URL = "https://asoutomohito1986-coder.github.io/BONSAI-Growth/favicon.ico";
        const BASE_RPC_URL = "https://mainnet.base.org";
        const CHAIN_ID = 8453;

        let ethereum;
        let provider;

        // Coinbase Wallet SDK ã®åˆæœŸåŒ–é–¢æ•°
        function initCoinbase() {
            try {
                const coinbaseWalletSDK = new CoinbaseWalletSDK({
                    appName: APP_NAME,
                    appLogoUrl: APP_LOGO_URL,
                    darkMode: false
                });
                ethereum
