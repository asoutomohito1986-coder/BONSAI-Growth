<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BONSAI GROWTH - AI Gen Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://unpkg.com/@coinbase/wallet-sdk@3.7.1/dist/index.js"></script>
    <style>
        body { text-align: center; background: #222; color: white; font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; }
        #title-screen { height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, #0052FF, #002d8d); }
        #game-screen { display: none; padding: 20px; background: #f4f4f2; color: #333; min-height: 100vh; }

        /* „Çπ„ÉÜ„Éº„Çø„Çπ„Ç®„É™„Ç¢ */
        .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-width: 400px; margin: 0 auto 20px; }
        .status-card { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .gp-val { font-size: 24px; color: #2e7d32; font-weight: bold; }

        /* ÁõÜÊ†ΩË°®Á§∫„Ç®„É™„Ç¢ */
        #bonsai-display { 
            width: 300px; height: 300px; margin: 20px auto; 
            background: #eee; border-radius: 20px; overflow: hidden;
            display: flex; align-items: center; justify-content: center;
            font-size: 100px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 5px solid white;
        }
        #bonsai-display img { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.5s; }

        /* „Éú„Çø„É≥ */
        .controls { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
        .btn { padding: 15px 25px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 16px; }
        .btn-water { background: #4caf50; color: white; box-shadow: 0 4px 0 #2e7d32; }
        .btn-grow { background: #ff9800; color: white; box-shadow: 0 4px 0 #e68a00; }
        .btn:disabled { background: #ccc !important; box-shadow: none !important; cursor: not-allowed; transform: translateY(4px); }
        .btn:active:not(:disabled) { transform: translateY(2px); box-shadow: none; }

        /* „Ç®„Éï„Çß„ÇØ„Éà */
        .shine { animation: shine-anim 0.8s; }
        @keyframes shine-anim {
            0% { filter: brightness(1); transform: scale(1); }
            50% { filter: brightness(1.5); transform: scale(1.05); }
            100% { filter: brightness(1); transform: scale(1); }
        }

        #loading-overlay { display: none; color: #666; font-size: 14px; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="title-screen">
        <div style="font-size: 80px;">üå≤</div>
        <h1 style="font-size: 32px; letter-spacing: 2px;">BONSAI GROWTH</h1>
        <button id="connect-btn" class="btn" style="background: white; color: #0052FF; width: 200px;">Connect Wallet</button>
    </div>

    <div id="game-screen">
        <div class="status-grid">
            <div class="status-card">
                <div style="font-size: 12px; color: #888;">GROWTH POINT</div>
                <div class="gp-val"><span id="gp-value">0</span> <small style="font-size: 12px;">GP</small></div>
            </div>
            <div class="status-card">
                <div style="font-size: 12px; color: #888;">ESTIMATED AGE</div>
                <div class="gp-val"><span id="age-display">0</span> <small style="font-size: 12px;">YEARS</small></div>
            </div>
        </div>

        <div id="bonsai-display">üå≤</div>
        <div id="loading-overlay">AI„ÅåÁîüÊàê‰∏≠... ‚è≥</div>
        
        <div class="controls">
            <button class="btn btn-water" onclick="actionWater()">üíß Ê∞¥„ÇÑ„Çä (+10GP)</button>
            <button class="btn btn-grow" id="grow-btn" onclick="actionGrow()" disabled>‚ú® ÊàêÈï∑ (50GP)</button>
        </div>

        <div id="death-info" style="margin-top: 20px; font-size: 12px; color: #d32f2f;"></div>
        <div id="wallet-addr" style="margin-top: 40px; font-size: 10px; opacity: 0.5;"></div>
        <button onclick="resetGame()" style="margin-top: 20px; border: none; background: transparent; color: #ccc; cursor: pointer;">[Reset Data]</button>
    </div>

    <script>
        let userAddress = "";
        let gp = 0;
        let estimatedAge = 0;
        let lastWatered = Date.now();
        let currentImg = "";
        const DEAD_LIMIT = 14 * 24 * 60 * 60 * 1000; // 14Êó•

        async function connect() {
            if (!window.ethereum) return;
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            userAddress = accounts[0];
            loadData();
            document.getElementById('title-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            updateUI();
        }

        function actionWater() {
            gp += 10;
            lastWatered = Date.now();
            const el = document.getElementById('bonsai-display');
            el.classList.add('shine');
            setTimeout(() => el.classList.remove('shine'), 800);
            saveData();
            updateUI();
        }

        async function actionGrow() {
            if (gp < 50) return;
            gp -= 50;
            estimatedAge += 5;
            
            const display = document.getElementById('bonsai-display');
            const loading = document.getElementById('loading-overlay');
            
            loading.style.display = "block";
            document.getElementById('grow-btn').disabled = true;

            // AIÁîªÂÉèÁîüÊàêÔºà„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥Ôºâ
            // ÂÆüÈöõ„ÅØ„Åì„Åì„Åã„Çâ„ÅÇ„Å™„Åü„ÅÆ„Çµ„Éº„Éê„ÉºÁµåÁî±„ÅßOpenAI„ÇíÂè©„ÅèÂΩ¢„Å´„Å™„Çä„Åæ„Åô
            const seed = Math.floor(Math.random() * 100000);
            const aiUrl = `https://pollinations.ai/p/bonsai%20tree,%20highly%20detailed,%20masterpiece,%20traditional%20japanese%20style,%20white%20background?width=300&height=300&seed=${seed}&nologo=true`;
            
            // ÁîªÂÉè„ÅÆ„Éó„É™„É≠„Éº„Éâ
            const img = new Image();
            img.src = aiUrl;
            img.onload = () => {
                currentImg = aiUrl;
                display.innerHTML = `<img src="${aiUrl}">`;
                loading.style.display = "none";
                saveData();
                updateUI();
            };
        }

        function loadData() {
            const data = JSON.parse(localStorage.getItem('bonsai_ai_v4_' + userAddress)) || 
                         { gp: 0, estimatedAge: 0, lastWatered: Date.now(), currentImg: "" };
            gp = data.gp;
            estimatedAge = data.estimatedAge;
            lastWatered = data.lastWatered;
            currentImg = data.currentImg;
        }

        function saveData() {
            localStorage.setItem('bonsai_ai_v4_' + userAddress, JSON.stringify({
                gp: gp, estimatedAge: estimatedAge, lastWatered: lastWatered, currentImg: currentImg
            }));
        }

        function updateUI() {
            document.getElementById('gp-value').innerText = gp;
            document.getElementById('age-display').innerText = estimatedAge;
            document.getElementById('grow-btn').disabled = (gp < 50);
            document.getElementById('wallet-addr').innerText = userAddress;

            const display = document.getElementById('bonsai-display');
            if (currentImg) {
                display.innerHTML = `<img src="${currentImg}">`;
            }

            // ÊûØÊ≠ªÂà§ÂÆö
            const diff = Date.now() - lastWatered;
            if (diff > DEAD_LIMIT) {
                display.innerHTML = "üçÇ";
                document.getElementById('death-info').innerText = "„Åì„ÅÆÁõÜÊ†Ω„ÅØÊûØ„Çå„Å¶„ÅÑ„Åæ„ÅôÔºà„Éâ„É©„Ç§ÁõÜÊ†ΩÔºâ";
                document.querySelector('.btn-water').disabled = true;
            } else {
                const days = Math.ceil((DEAD_LIMIT - diff) / (1000 * 60 * 60 * 24));
                document.getElementById('death-info').innerText = `„ÅÇ„Å® ${days} Êó•‰ª•ÂÜÖ„Å´Ê∞¥„ÇÑ„Çä„ÅåÂøÖË¶Å„Åß„Åô`;
            }
        }

        function resetGame() {
            if(confirm("„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü")) {
                localStorage.removeItem('bonsai_ai_v4_' + userAddress);
                location.reload();
            }
        }

        window.onload = () => { document.getElementById('connect-btn').onclick = connect; };
    </script>
</body>
</html>
