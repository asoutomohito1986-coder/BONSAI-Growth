<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BONSAI GRADUAL EVOLUTION</title>
    <style>
        body { text-align: center; background: #121212; color: #fff; font-family: sans-serif; margin: 0; }
        #game-screen { padding: 15px; }
        .stats { display: flex; justify-content: center; gap: 8px; margin: 15px 0; }
        .card { background: #333; padding: 10px; border-radius: 12px; flex: 1; border: 1px solid #444; }
        .val { font-size: 18px; color: #4caf50; font-weight: bold; }
        
        #view { width: 280px; height: 280px; background: #000; margin: 15px auto; border-radius: 20px; display: flex; align-items: center; justify-content: center; overflow: hidden; border: 4px solid #333; image-rendering: pixelated; }
        #view img { width: 100%; height: 100%; object-fit: cover; }

        .btn { padding: 15px; border-radius: 50px; border: none; font-weight: bold; font-size: 16px; margin: 5px; width: 90%; max-width: 320px; cursor: pointer; }
        .btn-w { background: #4caf50; color: #fff; box-shadow: 0 4px 0 #2e7d32; }
        .btn-g { background: #ff9800; color: #fff; box-shadow: 0 4px 0 #e68a00; }
        
        .style-selector { display: flex; justify-content: center; gap: 5px; margin: 10px 0; flex-wrap: wrap; }
        .btn-s { padding: 8px 12px; font-size: 12px; border-radius: 5px; background: #444; color: #ccc; border: 1px solid #666; width: auto; }
        .btn-s.active { background: #0052FF; color: #fff; border-color: #fff; }
        
        .btn:disabled { opacity: 0.2; transform: translateY(4px); box-shadow: none; }
        #timer { color:#ffeb3b; font-weight: bold; height:20px; margin:5px; }
    </style>
</head>
<body>

    <div id="game-screen">
        <div class="stats">
            <div class="card">GP<br><span id="ui-gp" class="val">0</span></div>
            <div class="card">Ê®πÈΩ¢<br><span id="ui-age" class="val">0</span></div>
            <div class="card">ÁõÆÊ®ô„ÅÆÂûã<br><span id="ui-target" class="val">-</span></div>
        </div>

        <div id="view">üå±</div>
        <div id="timer"></div>

        <button class="btn btn-w" onclick="doW()">üíß Ê∞¥„ÇÑ„Çä (+10GP)</button>
        <button id="gb" class="btn btn-g" onclick="doG()" disabled>‚ú® ÊàêÈï∑ (50GP)</button>
        
        <div style="margin-top: 20px; font-size: 13px; color: #aaa;">‚ñº Ê¨°„ÅÆÊàêÈï∑„ÅßÁõÆÊåá„ÅôÂûã„ÇíÈÅ∏Êäû</div>
        <div class="style-selector">
            <button id="s-chokkan" class="btn-s" onclick="setTarget('chokkan')">Áõ¥Âππ</button>
            <button id="s-shakan" class="btn-s" onclick="setTarget('shakan')">ÊñúÂππ</button>
            <button id="s-moyogi" class="btn-s" onclick="setTarget('moyogi')">Ê®°ÊßòÊú®</button>
        </div>

        <div id="status" style="font-size:11px; color:#666; margin-top:15px;"></div>
        <button onclick="if(confirm('„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü')){localStorage.clear();location.reload();}" style="margin-top:30px; opacity:0.1; background:none; color:#fff; border:none;">[Data Reset]</button>
    </div>

    <script>
        let gp=0, age=0, img="", last=Date.now(), targetStyle="chokkan";
        const LIMIT = 1209600000;

        window.onload = function() {
            const s = localStorage.getItem('bonsai_v14');
            if(s) {
                const d = JSON.parse(s);
                gp=d.gp||0; age=d.age||0; img=d.img||""; last=d.last||Date.now(); targetStyle=d.target||"chokkan";
            }
            update();
        };

        function setTarget(s) {
            targetStyle = s;
            save();
            update();
        }

        function doW() { gp+=10; last=Date.now(); save(); update(); }

        async function doG() {
            if(gp<50) return;
            gp-=50; age+=5;
            
            const v=document.getElementById('view'), b=document.getElementById('gb'), t=document.getElementById('timer');
            v.style.opacity="0.4"; b.disabled=true;
            
            let s=10;
            const i=setInterval(()=>{ t.innerText="Growing... "+s+"s"; s--; if(s<0)clearInterval(i); },1000);

            // --- Âæê„ÄÖ„Å´Â§âÂåñ„Åï„Åõ„Çã„Éó„É≠„É≥„Éó„ÉàÊà¶Áï• ---
            // targetStyle„Å†„Åë„Åß„Å™„Åè„ÄÅÁèæÂú®„ÅÆage„ÇÇÊ∑∑„Åú„Çã„Åì„Å®„Åß„ÄåÁßªË°åÊúü„Äç„ÇíË°®Áèæ
            let styleName = (targetStyle==='chokkan'?'formal upright':targetStyle==='shakan'?'slanted':'informal upright curved');
            
            // Ê®πÈΩ¢„Å´Âøú„Åò„Åü„Éô„Éº„ÇπÊåáÁ§∫
            let stage = (age < 50) ? "young sprout" : (age < 150) ? "growing tree" : "ancient majestic tree";
            
            // „Äåtransitioning toÔºà„Äú„Å∏ÁßªË°å‰∏≠Ôºâ„Äç„Å®„ÅÑ„ÅÜË®ÄËëâ„Çí„Éó„É≠„É≥„Éó„Éà„Å´Ê∑∑„Åú„Çã„Åì„Å®„Åß„ÄÅÊÄ•ÊøÄ„Å™Â§âÂåñ„ÇíÊäëÂà∂
            const prompt = encodeURIComponent(`16-bit_pixel_art, bonsai_tree, transitioning_to_${styleName}_style, ${stage}, in_pot, white_background, sharp_pixels`);
            
            const url = `https://image.pollinations.ai/prompt/${prompt}?seed=${Math.floor(Math.random()*9999)}&width=512&height=512&nologo=true`;

            const temp = new Image();
            temp.src = url;
            temp.onload = () => {
                clearInterval(i); t.innerText="EVOLVED!";
                img = url;
                v.innerHTML=`<img src="${url}">`; v.style.opacity="1";
                save(); update();
                setTimeout(()=>t.innerText="",2000);
            };
        }

        function save() { 
            localStorage.setItem('bonsai_v14', JSON.stringify({gp,age,img,last,target:targetStyle})); 
        }
        
        function update() {
            document.getElementById('ui-gp').innerText = gp;
            document.getElementById('ui-age').innerText = age;
            document.getElementById('gb').disabled = (gp < 50);
            
            // ÁõÆÊ®ô„Çπ„Çø„Ç§„É´„ÅÆË°®Á§∫Êõ¥Êñ∞
            const labels = {chokkan:'Áõ¥Âππ', shakan:'ÊñúÂππ', moyogi:'Ê®°ÊßòÊú®'};
            document.getElementById('ui-target').innerText = labels[targetStyle];
