<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BONSAI GROWTH - GP System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://unpkg.com/@coinbase/wallet-sdk@3.7.1/dist/index.js"></script>
    <style>
        body { text-align: center; background: #f0f4f0; font-family: sans-serif; margin: 0; }
        #title-screen { background: #0052FF; color: white; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #game-screen { display: none; padding: 20px; }
        
        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
        .status-card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: inline-block; min-width: 250px; margin-bottom: 20px; }
        .gp-display { font-size: 32px; color: #2e7d32; font-weight: bold; margin: 10px 0; }
        .rank-badge { background: #e8f5e9; color: #2e7d32; padding: 4px 12px; border-radius: 20px; font-size: 14px; font-weight: bold; }
        
        /* ç›†æ ½ã®è¦‹ãŸç›® */
        .bonsai-container { font-size: 120px; margin: 40px 0; transition: transform 0.2s; }
        .bonsai-container:active { transform: scale(1.1); }
        
        /* ãƒœã‚¿ãƒ³ */
        .btn-water { background: #4caf50; color: white; padding: 18px 50px; font-size: 22px; border-radius: 50px; border: none; cursor: pointer; box-shadow: 0 4px 0 #388e3c; }
        .btn-water:active { transform: translateY(3px); box-shadow: none; }
        
        #wallet-addr { font-size: 10px; color: #999; margin-top: 40px; }
    </style>
</head>
<body>

    <div id="title-screen">
        <div style="font-size: 80px;">ğŸŒ²</div>
        <h1>BONSAI GROWTH</h1>
        <p>Your Web3 Bonsai Journey</p>
        <button id="connect-btn" style="padding: 15px 30px; border-radius: 10px; font-weight: bold; cursor: pointer;">ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³</button>
    </div>

    <div id="game-screen">
        <div class="status-card">
            <div id="rank-display" class="rank-badge">RANK: è‹—æœ¨</div>
            <div class="gp-display"><span id="gp-value">0</span> GP</div>
            <div style="font-size: 12px; color: #666;">æ¨¹é½¢: <span id="age-display">0</span> æ—¥</div>
        </div>

        <div id="bonsai-display" class="bonsai-container">ğŸŒ±</div>
        
        <button class="btn-water" onclick="actionWater()">ğŸ’§ æ°´ã‚„ã‚Š (+10GP)</button>
        
        <p id="msg-box" style="margin-top: 20px; color: #555; font-weight: bold; height: 1.2em;"></p>

        <div id="wallet-addr"></div>
        <button onclick="resetGame()" style="margin-top: 30px; opacity: 0.3; border: none; background: none; cursor: pointer;">[ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ]</button>
    </div>

    <script>
        let userAddress = "";
        let gp = 0;
        let age = 0;

        // --- 1. æ¥ç¶šæ©Ÿèƒ½ ---
        async function connect() {
            if (!window.ethereum) { alert("Coinbase Walletã‚¢ãƒ—ãƒªã§é–‹ã„ã¦ãã ã•ã„"); return; }
            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                userAddress = accounts[0];
                
                loadData(); // ã‚»ãƒ¼ãƒ–ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
                
                document.getElementById('title-screen').style.display = 'none';
                document.getElementById('game-screen').style.display = 'block';
                updateUI();
            } catch (e) { console.error(e); }
        }

        // --- 2. æ°´ã‚„ã‚Šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ (1å›10GP) ---
        function actionWater() {
            gp += 10;
            age += 1;
            
            document.getElementById('msg-box').innerText = "æ°´ã‚„ã‚Šå®Œäº†ï¼ã™ãã™ãè‚²ã£ã¦ã„ã¾ã™ã€‚";
            
            saveData();
            updateUI();
            
            // æ¼”å‡ºï¼šå°‘ã—å¤§ããæºã‚Œã‚‹
            const el = document.getElementById('bonsai-display');
            el.style.transform = "scale(1.2)";
            setTimeout(() => el.style.transform = "scale(1.0)", 200);
            
            // 3ç§’å¾Œã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¶ˆã™
            setTimeout(() => { document.getElementById('msg-box').innerText = ""; }, 3000);
        }

        // --- 3. ã‚»ãƒ¼ãƒ–ãƒ»ãƒ­ãƒ¼ãƒ‰ ---
        function loadData() {
            const data = JSON.parse(localStorage.getItem('bonsai_v3_main_' + userAddress)) || { gp: 0, age: 0 };
            gp = data.gp;
            age = data.age;
        }

        function saveData() {
            const data = { gp: gp, age: age };
            localStorage.setItem('bonsai_v3_main_' + userAddress, JSON.stringify(data));
        }

        // --- 4. ç”»é¢æ›´æ–°ã¨é€²åŒ–ãƒ­ã‚¸ãƒƒã‚¯ ---
        function updateUI() {
            document.getElementById('gp-value').innerText = gp;
            document.getElementById('age-display').innerText = age;
            document.getElementById('wallet-addr').innerText = "Wallet: " + userAddress;

            const display = document.getElementById('bonsai-display');
            const rank = document.getElementById('rank-display');

            // GPã«å¿œã˜ãŸé€²åŒ–ï¼ˆã“ã“ã§ã®æ•°å€¤ã¯ãƒ†ã‚¹ãƒˆç”¨ã«ä½ã‚ã«è¨­å®šã—ã¦ã„ã¾ã™ï¼‰
            if (gp >= 100) {
                display.innerText = "ğŸŒ³"; 
                rank.innerText = "RANK: è€æ¨¹";
                rank.style.background = "#fff3e0";
                rank.style.color = "#ef6c00";
            } else if (gp >= 50) {
                display.innerText = "ğŸŒ²"; 
                rank.innerText = "RANK: è‹¥æœ¨";
                rank.style.background = "#e8f5e9";
                rank.style.color = "#2e7d32";
            } else {
                display.innerText = "ğŸŒ±"; 
                rank.innerText = "RANK: è‹—æœ¨";
            }
        }

        function resetGame() {
            if(confirm("ã“ã®ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã®ç›†æ ½ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
                localStorage.removeItem('bonsai_v3_main_' + userAddress);
                location.reload();
            }
        }

        window.onload = () => {
            document.getElementById('connect-btn').onclick = connect;
        };
    </script>
</body>
</html>
